import{G as U,a4 as ae,r as _,J as r,M as t,P as p,$ as n,Z as h,U as V,al as X,O as se,f as M,aW as le,B as i}from"./vendor-vue-rrJoI5pD.js";import{_ as ne,u as oe,a as J}from"./index-zOXOKCmm.js";import"./vendor-BgxNQcjb.js";import"./vendor-element-Bmt4lDx1.js";import"./vendor-socket-DmpRiKjA.js";const re={class:"page-shell relative"},ie={class:"page-container space-y-6 relative z-10 pb-24 lg:pb-6"},de={class:"card lg:hidden"},ce={class:"flex items-center justify-between"},ue={class:"flex items-center gap-3 mb-2"},ve={class:"px-2 py-1 bg-emerald-50 rounded-lg"},_e={class:"text-xs font-semibold flex items-center gap-1"},pe={class:"text-sm text-slate-500"},xe={class:"hidden lg:block"},ge={class:"subtitle"},he={class:"card flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between"},me={class:"flex flex-wrap gap-2"},fe={class:"flex items-center gap-3"},be={class:"text-sm font-semibold text-slate-700"},ye={class:"card"},we={class:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between"},De={key:0,class:"mt-2 text-3xl font-semibold text-slate-900"},ke={key:1,class:"mt-2 text-3xl font-semibold text-slate-900"},$e={key:2,class:"mt-2 flex flex-wrap gap-3 text-xs text-slate-500"},Pe={key:0},Le={key:1},Me={key:3,class:"mt-2 flex flex-wrap gap-2 text-xs text-slate-500"},je={class:"mt-4 grid gap-3 sm:grid-cols-2"},Ce={class:"rounded-xl border border-slate-200 bg-slate-50 p-3"},Se={class:"mt-1 text-lg font-semibold text-slate-900"},Be={class:"rounded-xl border border-slate-200 bg-slate-50 p-3"},Ie={class:"mt-1 text-lg font-semibold text-slate-900"},Fe={class:"mt-4 grid gap-3 sm:grid-cols-2 lg:grid-cols-4"},Ne={class:"rounded-xl border border-slate-200 bg-white p-3"},Re={class:"mt-1 text-lg font-semibold text-slate-900"},Ae={class:"rounded-xl border border-slate-200 bg-white p-3"},Ee={class:"mt-1 text-lg font-semibold text-slate-900"},Te={class:"rounded-xl border border-slate-200 bg-white p-3"},Ve={class:"mt-1 text-lg font-semibold text-slate-900"},Xe={class:"rounded-xl border border-slate-200 bg-white p-3"},ze={class:"mt-1 text-lg font-semibold text-slate-900"},Oe={class:"card"},Ye={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},He={class:"text-lg font-semibold text-slate-900"},Ue={class:"subtitle"},Je={class:"mt-6 grid gap-4 lg:grid-cols-[auto,1fr]"},Ge={class:"hidden sm:flex flex-col gap-3 text-xs text-slate-500"},We={class:"overflow-x-auto"},Ze={class:"min-w-[640px] lg:min-w-0"},qe={class:"relative h-56 sm:h-64 lg:h-72 w-full rounded-2xl border border-slate-200 bg-slate-50 p-4"},Ke=["d"],Qe=["x1","x2"],et=["cx","cy"],tt={class:"font-semibold text-slate-700"},at={class:"font-bold text-emerald-600"},st={class:"mt-3 flex justify-between text-xs text-slate-500"},lt={__name:"DashboardViewNew",setup(nt){le(),oe();const j=_(navigator.onLine),C=()=>{j.value=navigator.onLine};U(()=>{window.addEventListener("online",C),window.addEventListener("offline",C),I(),F(),N()}),ae(()=>{window.removeEventListener("online",C),window.removeEventListener("offline",C)});const A=_(new Date().toLocaleString("id-ID")),$=_(""),P=_(""),u=_("daily"),L=_(""),S=_(new Date),l=_({total_orders:0,total_revenue:0,avg_order_value:0,avg_basket_size:0,avg_pax:0,total_pax:0,revenue_change_pct:0,orders_change_pct:0,avg_order_change_pct:0,basket_change_pct:0,paid_revenue:0,unpaid_revenue:0,paid_revenue_change_pct:0,unpaid_revenue_change_pct:0,additional_charges_total:0,additional_charges_items:[],void_total:0,cancelled_total:0,products_sold:0,products_sold_change_pct:0}),v=_([]),m=_(0),E=_(!1),d=_(null),G=M(()=>l.value.total_revenue-l.value.void_total-l.value.cancelled_total),x=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),W=a=>{if(!a)return"";const e=a.name||"";if(a.charge_type==="percentage"){const s=e.includes("%"),o=a.value,g=o!=null&&!Number.isNaN(o)?`${o}%`:"%";return`${s?e:`${e} (${g})`}: ${x(a.total_amount)}`}return`${e} (Rp): ${x(a.total_amount)}`},f=a=>{const s=Math.abs(a).toFixed(2);return a>=0?`▲ ${s}%`:`▼ ${s}%`},b=a=>a>=0?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-600",w=a=>{const e=new Date(a),s=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0");return`${s}-${o}-${g}`},z=M(()=>{if(v.value.length===0||m.value===0)return"";const a=800,e=200,s=20,o=v.value.length,g=o>1?(a-s*2)/(o-1):0;let c="";return v.value.forEach((D,y)=>{const k=s+y*g,R=e-s-D.revenue/m.value*(e-s*2);y===0?c=`M ${k} ${R}`:c+=` L ${k} ${R}`}),c}),Z=a=>{if(u.value==="daily")return`${a.time_label}:00`;const e=new Date(a.time_label);return`${e.getDate()}/${e.getMonth()+1}`},B=M(()=>{if(v.value.length===0||m.value===0)return[];const a=800,e=200,s=20,o=v.value.length,g=o>1?(a-s*2)/(o-1):0;return v.value.map((c,D)=>{const y=s+D*g,k=e-s-c.revenue/m.value*(e-s*2);return{x:y,y:k,revenue:c.revenue||0,label:Z(c)}})}),q=a=>{if(B.value.length===0)return;const e=a.currentTarget.getBoundingClientRect(),s=a.clientX-e.left,o=800/e.width,g=s*o;let c=B.value[0],D=0,y=Math.abs(B.value[0].x-g);B.value.forEach((Y,te)=>{const H=Math.abs(Y.x-g);H<y&&(c=Y,D=te,y=H)});const k=c.x/800*e.width,R=c.y/200*e.height;d.value={...c,index:D,offsetX:k,offsetY:R}},K=()=>{d.value=null},Q=M(()=>{if(m.value===0)return["0","1 jt","2 jt","3 jt","4 jt"];const a=m.value,e=s=>s>=1e6?(s/1e6).toFixed(1)+" jt":s>=1e3?(s/1e3).toFixed(0)+" rb":s.toFixed(0);return[e(a),e(a*.75),e(a*.5),e(a*.25),"0"]}),ee=M(()=>{if(v.value.length===0)return[];if(u.value==="daily")return v.value.map(s=>s.time_label+":00");const a=v.value.length,e=Math.ceil(a/10);return v.value.filter((s,o)=>o%e===0).map(s=>{const o=new Date(s.time_label);return`${o.getDate()}/${o.getMonth()+1}`})}),I=()=>{const a=new Date(S.value);if(u.value==="daily")$.value=w(a),P.value=w(a),L.value=a.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});else if(u.value==="weekly"){const e=new Date(a);e.setDate(a.getDate()-a.getDay());const s=new Date(e);s.setDate(e.getDate()+6),$.value=w(e),P.value=w(s),L.value=`${e.getDate()} ${e.toLocaleDateString("id-ID",{month:"short"})} - ${s.getDate()} ${s.toLocaleDateString("id-ID",{month:"short",year:"numeric"})}`}else{const e=new Date(a.getFullYear(),a.getMonth(),1),s=new Date(a.getFullYear(),a.getMonth()+1,0);$.value=w(e),P.value=w(s),L.value=a.toLocaleDateString("id-ID",{month:"long",year:"numeric"})}},T=a=>{u.value=a,S.value=new Date,I(),F(),N()},O=a=>{const e=new Date(S.value);u.value==="daily"?e.setDate(e.getDate()+a):u.value==="weekly"?e.setDate(e.getDate()+a*7):e.setMonth(e.getMonth()+a),S.value=e,I(),F(),N()},F=async()=>{E.value=!0;try{const a=await J.get("/orders/analytics",{params:{start_date:$.value,end_date:P.value}});if(a.data?.success){const e=a.data.data.analytics||{},s=Array.isArray(e.additional_charges_items)?e.additional_charges_items.filter(o=>(o?.total_amount||0)!==0):[];l.value={...e,additional_charges_items:s},A.value=new Date().toLocaleString("id-ID")}}catch(a){console.error("Failed to fetch analytics:",a)}finally{E.value=!1}},N=async()=>{try{const a=await J.get("/orders/chart",{params:{start_date:$.value,end_date:P.value,period:u.value}});a.data?.success&&(v.value=a.data.data.data||[],m.value=Math.max(...v.value.map(e=>e.revenue||0),0))}catch(a){console.error("Failed to fetch chart data:",a)}};return U(()=>{I(),F(),N()}),(a,e)=>(i(),r("div",re,[t("div",ie,[t("div",de,[t("div",ce,[t("div",null,[t("div",ue,[e[5]||(e[5]=t("h1",{class:"text-2xl font-bold bg-gradient-to-r from-emerald-600 to-emerald-500 bg-clip-text text-transparent"},"Dashboard",-1)),t("div",ve,[t("span",_e,[t("span",{class:p(["w-1.5 h-1.5 rounded-full",j.value?"bg-emerald-500 animate-pulse":"bg-red-500"])},null,2),t("span",{class:p(j.value?"text-emerald-700":"text-red-700")},n(j.value?"Online":"Offline"),3)])])]),t("p",pe,"Diperbarui "+n(A.value),1)])])]),t("div",xe,[t("p",ge,"Diperbarui "+n(A.value),1)]),t("div",he,[t("div",me,[t("button",{onClick:e[0]||(e[0]=s=>T("daily")),class:p([u.value==="daily"?"bg-emerald-600 text-white":"bg-white text-slate-600 border border-slate-200","cursor-pointer rounded-xl px-4 py-2 text-sm font-semibold transition hover:scale-105 active:scale-95"])}," Harian ",2),t("button",{onClick:e[1]||(e[1]=s=>T("weekly")),class:p([u.value==="weekly"?"bg-emerald-600 text-white":"bg-white text-slate-600 border border-slate-200","cursor-pointer rounded-xl px-4 py-2 text-sm font-semibold transition hover:scale-105 active:scale-95"])}," Mingguan ",2),t("button",{onClick:e[2]||(e[2]=s=>T("monthly")),class:p([u.value==="monthly"?"bg-emerald-600 text-white":"bg-white text-slate-600 border border-slate-200","cursor-pointer rounded-xl px-4 py-2 text-sm font-semibold transition hover:scale-105 active:scale-95"])}," Bulanan ",2)]),t("div",fe,[t("button",{onClick:e[3]||(e[3]=s=>O(-1)),class:"btn-secondary cursor-pointer"},"‹"),t("span",be,n(L.value),1),t("button",{onClick:e[4]||(e[4]=s=>O(1)),class:"btn-secondary cursor-pointer"},"›")])]),t("div",ye,[t("div",we,[t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm font-semibold text-slate-500"},"Total Penjualan",-1)),E.value?(i(),r("p",ke,"Memuat...")):(i(),r("p",De,n(x(G.value)),1)),l.value.void_total||l.value.cancelled_total?(i(),r("div",$e,[l.value.void_total?(i(),r("span",Pe,"Void: -"+n(x(l.value.void_total)),1)):h("",!0),l.value.cancelled_total?(i(),r("span",Le,"Batal: -"+n(x(l.value.cancelled_total)),1)):h("",!0)])):h("",!0),l.value.additional_charges_items&&l.value.additional_charges_items.length?(i(),r("div",Me,[(i(!0),r(V,null,X(l.value.additional_charges_items,(s,o)=>(i(),r("span",{key:o},n(W(s)),1))),128))])):h("",!0)]),t("span",{class:p(["rounded-full px-3 py-1 text-xs font-semibold",b(l.value.revenue_change_pct)])},n(f(l.value.revenue_change_pct)),3)]),t("div",je,[t("div",Ce,[e[7]||(e[7]=t("p",{class:"text-xs text-slate-500"},"Penjualan Terbayar",-1)),t("p",Se,n(x(l.value.paid_revenue)),1),t("span",{class:p(["mt-2 inline-flex rounded-full px-2 py-1 text-xs font-semibold",b(l.value.paid_revenue_change_pct)])},n(f(l.value.paid_revenue_change_pct)),3)]),t("div",Be,[e[8]||(e[8]=t("p",{class:"text-xs text-slate-500"},"Penjualan Belum Dibayar",-1)),t("p",Ie,n(x(l.value.unpaid_revenue)),1),t("span",{class:p(["mt-2 inline-flex rounded-full px-2 py-1 text-xs font-semibold",b(l.value.unpaid_revenue_change_pct)])},n(f(l.value.unpaid_revenue_change_pct)),3)])]),t("div",Fe,[t("div",Ne,[e[9]||(e[9]=t("p",{class:"text-xs text-slate-500"},"Transaksi",-1)),t("p",Re,n(l.value.total_orders),1),t("span",{class:p(["mt-2 inline-flex rounded-full px-2 py-1 text-xs font-semibold",b(l.value.orders_change_pct)])},n(f(l.value.orders_change_pct)),3)]),t("div",Ae,[e[10]||(e[10]=t("p",{class:"text-xs text-slate-500"},"Basket Value",-1)),t("p",Ee,n(x(l.value.avg_order_value)),1),t("span",{class:p(["mt-2 inline-flex rounded-full px-2 py-1 text-xs font-semibold",b(l.value.avg_order_change_pct)])},n(f(l.value.avg_order_change_pct)),3)]),t("div",Te,[e[11]||(e[11]=t("p",{class:"text-xs text-slate-500"},"Produk Terjual",-1)),t("p",Ve,n(Math.round(l.value.products_sold)),1),t("span",{class:p(["mt-2 inline-flex rounded-full px-2 py-1 text-xs font-semibold",b(l.value.products_sold_change_pct)])},n(f(l.value.products_sold_change_pct)),3)]),t("div",Xe,[e[12]||(e[12]=t("p",{class:"text-xs text-slate-500"},"Penjualan per Transaksi",-1)),t("p",ze,n(x(l.value.avg_order_value)),1),t("span",{class:p(["mt-2 inline-flex rounded-full px-2 py-1 text-xs font-semibold",b(l.value.avg_order_change_pct)])},n(f(l.value.avg_order_change_pct)),3)])])]),t("div",Oe,[t("div",Ye,[t("div",null,[t("h3",He,"Penjualan "+n(L.value),1),t("p",Ue,n(u.value==="daily"?"Penjualan per Jam":"Penjualan Harian"),1)]),e[13]||(e[13]=t("span",{class:"badge"},"Total Penjualan",-1))]),t("div",Je,[t("div",Ge,[(i(!0),r(V,null,X(Q.value,(s,o)=>(i(),r("span",{key:o},n(s),1))),128))]),t("div",We,[t("div",Ze,[t("div",qe,[(i(),r("svg",{viewBox:"0 0 800 200",class:"h-full w-full",onMousemove:q,onMouseleave:K},[z.value?(i(),r("path",{key:0,d:z.value,fill:"none",stroke:"#10B981","stroke-width":"3"},null,8,Ke)):h("",!0),d.value?(i(),r("line",{key:1,x1:d.value.x,x2:d.value.x,y1:"0",y2:"200",stroke:"#10B981","stroke-width":"1","stroke-dasharray":"4 4",opacity:"0.5"},null,8,Qe)):h("",!0),d.value?(i(),r("circle",{key:2,cx:d.value.x,cy:d.value.y,r:"5",fill:"#10B981",stroke:"white","stroke-width":"2"},null,8,et)):h("",!0)],32)),d.value?(i(),r("div",{key:0,class:"pointer-events-none absolute z-10 -translate-x-1/2 -translate-y-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs shadow-lg",style:se({left:`${d.value.offsetX}px`,top:`${d.value.offsetY}px`})},[t("div",tt,n(d.value.label),1),t("div",at,n(x(d.value.revenue)),1)],4)):h("",!0)]),t("div",st,[(i(!0),r(V,null,X(ee.value,(s,o)=>(i(),r("span",{key:o},n(s),1))),128))])])])])])])]))}},ut=ne(lt,[["__scopeId","data-v-d003e102"]]);export{ut as default};
