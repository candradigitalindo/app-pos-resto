import{w as W,G as q,J as v,M as e,$ as i,aY as J,X as p,au as C,a$ as P,U as M,al as $,K as R,L as z,a7 as X,Z as Y,f as V,r as d,aW as Z,B as m}from"./vendor-vue-rrJoI5pD.js";import{a as w,b as ee}from"./index-BW_WdKWW.js";import{_ as te,a as se}from"./Pagination-DIW_Ff4w.js";import"./vendor-BgxNQcjb.js";import"./vendor-element-Bmt4lDx1.js";import"./vendor-socket-DmpRiKjA.js";const ae={class:"min-h-screen pb-20 lg:pb-6"},le={class:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8"},oe={class:"mb-6 overflow-hidden rounded-2xl bg-gradient-to-r from-emerald-600 to-emerald-500 p-6 shadow-xl"},ne={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},re={class:"flex items-center gap-3"},ie={class:"flex h-11 w-11 items-center justify-center rounded-xl bg-white/20 text-lg font-bold text-white shadow-lg"},de={class:"mb-6 grid gap-4 lg:grid-cols-3"},ue={class:"rounded-2xl bg-white p-4 shadow-lg"},ve={class:"flex items-center gap-3"},me={class:"text-lg font-bold text-slate-900"},ce={class:"rounded-2xl bg-white p-4 shadow-lg"},pe={class:"flex items-center gap-3"},fe={class:"text-lg font-bold text-slate-900"},xe={class:"rounded-2xl bg-white p-4 shadow-lg"},be={class:"flex items-center gap-3"},ge={class:"text-lg font-bold text-slate-900"},we={class:"mb-6 flex flex-col gap-3 rounded-2xl bg-white p-4 shadow-lg sm:flex-row sm:items-center sm:justify-between"},he={class:"flex items-center gap-2"},ke={class:"relative w-64"},ye=["value"],_e={key:0,class:"rounded-2xl bg-white p-12 text-center shadow-lg"},Ue={key:1,class:"space-y-4"},Ce=["value","disabled","onChange"],Me=["value"],je={class:"flex items-center justify-center gap-2"},Be=["disabled","onClick"],Ne=["disabled","onClick"],$e={class:"w-full max-w-2xl overflow-hidden rounded-2xl bg-white shadow-2xl"},ze={class:"bg-gradient-to-r from-emerald-600 to-emerald-500 p-6"},Ve={class:"flex items-center justify-between"},Le={class:"flex items-center gap-3"},Se={class:"text-xl font-bold text-white"},Fe={class:"text-sm text-emerald-100"},Pe={class:"max-h-[60vh] overflow-y-auto p-6"},Re={class:"space-y-5"},Te=["value"],Ae=["placeholder"],De={class:"flex items-center justify-end gap-2 border-t border-slate-100 px-6 py-4"},Ee=["disabled"],qe={__name:"UsersView",setup(Ge){const T=Z(),{success:h,error:r,confirm:A}=ee(),D=[{key:"username",label:"Username"},{key:"full_name",label:"Nama Lengkap"},{key:"role",label:"Role",align:"text-center"},{key:"status",label:"Status",align:"text-center"},{key:"actions",label:"Aksi",align:"text-center"}],k=[{value:"admin",label:"Admin"},{value:"manager",label:"Manager"},{value:"cashier",label:"Kasir"},{value:"waiter",label:"Waiter"},{value:"kitchen",label:"Kitchen"},{value:"bar",label:"Bar"}],j=d(!1),f=d([]),B=d(!1),o=d(null),y=d(!1),l=d({username:"",full_name:"",role:"",password:""}),u=d({current_page:1,total_pages:1,total_items:0,page_size:10}),x=d(""),c=d(""),b=d({}),N=V(()=>u.value.total_items),L=V(()=>{const s=k.reduce((t,a)=>(t[a.value]=0,t),{});return f.value.forEach(t=>{s[t.role]!==void 0&&(s[t.role]+=1)}),s}),E=V(()=>{const s=x.value.trim().toLowerCase();return f.value.filter(t=>{const a=!s||t.username?.toLowerCase().includes(s)||t.full_name?.toLowerCase().includes(s),n=!c.value||t.role===c.value;return a&&n})}),_=(s,t)=>{b.value={...b.value,[s]:t}},G=()=>{T.push("/")},g=async()=>{j.value=!0;try{const s={page:u.value.current_page,page_size:u.value.page_size},t=await w.get("/users",{params:s});f.value=t.data.data||[],t.data.pagination&&(u.value=t.data.pagination)}catch{r("Gagal memuat data user")}finally{j.value=!1}},K=async(s,t)=>{if(!(!t||t===s.role)){_(s.id,!0);try{const n=(await w.put(`/users/${s.id}/role`,{role:t})).data.data;f.value=f.value.map(F=>F.id===s.id?n:F),h("Role user berhasil diperbarui")}catch(a){r(a.response?.data?.message||"Gagal memperbarui role user"),await g()}finally{_(s.id,!1)}}},I=s=>{A(`Nonaktifkan user ${s.username}?`,async()=>{_(s.id,!0);try{await w.delete(`/users/${s.id}`),h("User berhasil dinonaktifkan"),await g()}catch(t){r(t.response?.data?.message||"Gagal menonaktifkan user")}finally{_(s.id,!1)}})},H=s=>{u.value.current_page=s,g()},O=()=>{x.value="",c.value=""},S=(s=null)=>{s?(o.value=s,l.value={username:s.username||"",full_name:s.full_name||"",role:s.role||"",password:""}):(o.value=null,l.value={username:"",full_name:"",role:"",password:""}),B.value=!0},U=()=>{B.value=!1,o.value=null,l.value={username:"",full_name:"",role:"",password:""}},Q=async()=>{const s={};if(!l.value.username.trim()){r("Username wajib diisi");return}if(!l.value.full_name.trim()){r("Nama lengkap wajib diisi");return}if(!l.value.role){r("Role wajib dipilih");return}if(o.value){if(l.value.username!==o.value.username&&(s.username=l.value.username.trim()),l.value.full_name!==o.value.full_name&&(s.full_name=l.value.full_name.trim()),l.value.role!==o.value.role&&(s.role=l.value.role),l.value.password){if(!/^\d{4}$/.test(l.value.password)){r("PIN harus 4 digit angka");return}s.password=l.value.password}if(Object.keys(s).length===0){r("Tidak ada data yang diubah");return}}else{if(!/^\d{4}$/.test(l.value.password)){r("PIN harus 4 digit angka");return}s.username=l.value.username.trim(),s.full_name=l.value.full_name.trim(),s.role=l.value.role,s.password=l.value.password}try{y.value=!0,o.value?(await w.put(`/users/${o.value.id}`,s),h("User berhasil diperbarui")):(await w.post("/auth/register",s),h("User berhasil ditambahkan")),await g(),U()}catch(t){r(t.response?.data?.message||"Gagal menyimpan user")}finally{y.value=!1}};return W([x,c],()=>{u.value.current_page=1}),q(()=>{g()}),(s,t)=>(m(),v(M,null,[e("div",ae,[e("div",le,[e("div",oe,[e("div",ne,[e("div",{class:"flex items-center gap-4"},[e("button",{onClick:G,class:"flex h-10 w-10 items-center justify-center rounded-xl bg-white/20 text-white backdrop-blur-sm transition-all hover:bg-white/30 hover:scale-105 active:scale-95"},[...t[7]||(t[7]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t[8]||(t[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-white"},"Manajemen User"),e("p",{class:"mt-1 text-sm text-emerald-100"},"Kelola akun pengguna dan hak akses")],-1))]),e("div",re,[e("div",ie,i(N.value),1),t[9]||(t[9]=e("div",null,[e("div",{class:"text-sm font-semibold text-white"},"User aktif"),e("div",{class:"text-xs text-emerald-100"},"Total terdaftar")],-1))])])]),e("div",de,[e("div",ue,[e("div",ve,[t[11]||(t[11]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-100 text-emerald-600"},[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)),e("div",null,[t[10]||(t[10]=e("div",{class:"text-xs text-slate-500"},"Total User",-1)),e("div",me,i(N.value),1)])])]),e("div",ce,[e("div",pe,[t[13]||(t[13]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-slate-100 text-slate-600"},[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 11c2.209 0 4-1.791 4-4S14.209 3 12 3s-4 1.791-4 4 1.791 4 4 4zM4 21v-1a7 7 0 0114 0v1"})])],-1)),e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs text-slate-500"},"Admin",-1)),e("div",fe,i(L.value.admin),1)])])]),e("div",xe,[e("div",be,[t[15]||(t[15]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-amber-100 text-amber-600"},[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a4 4 0 00-3-3.87M9 20h5v-2a4 4 0 00-3-3.87M3 20h5v-2a4 4 0 00-3-3.87M9 7a3 3 0 106 0 3 3 0 00-6 0z"})])],-1)),e("div",null,[t[14]||(t[14]=e("div",{class:"text-xs text-slate-500"},"Non-admin",-1)),e("div",ge,i(N.value-L.value.admin),1)])])])]),e("div",we,[t[18]||(t[18]=J('<div class="flex items-center gap-3"><div class="flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-100 text-emerald-600"><svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 017 7H5a7 7 0 017-7z"></path></svg></div><div><div class="text-sm font-semibold text-slate-900">Daftar User</div><div class="text-xs text-slate-500">Data user aktif dari backend</div></div></div>',1)),e("div",he,[e("div",ke,[p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>x.value=a),type:"text",class:"input w-full pr-10",placeholder:"Cari username atau nama..."},null,512),[[C,x.value]]),t[16]||(t[16]=e("div",{class:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-slate-400"},[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a),class:"input w-44"},[t[17]||(t[17]=e("option",{value:""},"Semua Role",-1)),(m(),v(M,null,$(k,a=>e("option",{key:a.value,value:a.value},i(a.label),9,ye)),64))],512),[[P,c.value]]),e("button",{onClick:O,class:"btn-secondary"},"Reset"),e("button",{onClick:t[2]||(t[2]=a=>S()),class:"btn-primary"},"Tambah User")])]),j.value?(m(),v("div",_e,[...t[19]||(t[19]=[e("div",{class:"mx-auto mb-4 h-10 w-10 animate-spin rounded-full border-4 border-emerald-200 border-t-emerald-500"},null,-1),e("div",{class:"text-sm font-semibold text-slate-600"},"Memuat data user...",-1)])])):(m(),v("div",Ue,[R(te,{columns:D,data:E.value,"item-key":"id"},{"cell-role":z(({item:a})=>[e("select",{value:a.role,class:"input text-sm",disabled:b.value[a.id],onChange:n=>K(a,n.target.value)},[(m(),v(M,null,$(k,n=>e("option",{key:n.value,value:n.value},i(n.label),9,Me)),64))],40,Ce)]),"cell-status":z(({item:a})=>[...t[20]||(t[20]=[e("span",{class:"inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2.5 py-1 text-xs font-semibold text-emerald-700"}," Aktif ",-1)])]),"cell-actions":z(({item:a})=>[e("div",je,[e("button",{class:"rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-1.5 text-xs font-semibold text-emerald-700 transition hover:bg-emerald-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:b.value[a.id],onClick:n=>S(a)}," Edit ",8,Be),e("button",{class:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-1.5 text-xs font-semibold text-rose-600 transition hover:bg-rose-100 disabled:cursor-not-allowed disabled:opacity-60",disabled:b.value[a.id],onClick:n=>I(a)}," Nonaktifkan ",8,Ne)])]),_:1},8,["data"]),R(se,{"current-page":u.value.current_page,"total-pages":u.value.total_pages,"total-items":u.value.total_items,"item-name":"user",onPageChange:H},null,8,["current-page","total-pages","total-items"])]))])]),B.value?(m(),v("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm px-4",onClick:X(U,["self"])},[e("div",$e,[e("div",ze,[e("div",Ve,[e("div",Le,[t[21]||(t[21]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-white/20 backdrop-blur-sm"},[e("svg",{class:"h-6 w-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 017 7H5a7 7 0 017-7z"})])],-1)),e("div",null,[e("h2",Se,i(o.value?"Edit User":"Tambah User"),1),e("p",Fe,i(o.value?"Update informasi user":"Tambahkan user baru"),1)])]),e("button",{onClick:U,class:"flex h-10 w-10 items-center justify-center rounded-xl bg-white/20 text-white backdrop-blur-sm transition-all hover:bg-white/30 hover:rotate-90"},[...t[22]||(t[22]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),e("div",Pe,[e("div",Re,[e("div",null,[t[23]||(t[23]=e("label",{class:"mb-2 block text-sm font-bold text-slate-700"},"Username",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>l.value.username=a),type:"text",class:"input w-full",placeholder:"Masukkan username"},null,512),[[C,l.value.username]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"mb-2 block text-sm font-bold text-slate-700"},"Nama Lengkap",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>l.value.full_name=a),type:"text",class:"input w-full",placeholder:"Masukkan nama lengkap"},null,512),[[C,l.value.full_name]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"mb-2 block text-sm font-bold text-slate-700"},"Role",-1)),p(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>l.value.role=a),class:"input w-full"},[t[25]||(t[25]=e("option",{value:"",disabled:""},"Pilih role",-1)),(m(),v(M,null,$(k,a=>e("option",{key:a.value,value:a.value},i(a.label),9,Te)),64))],512),[[P,l.value.role]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"mb-2 block text-sm font-bold text-slate-700"},"PIN",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>l.value.password=a),type:"password",class:"input w-full",placeholder:o.value?"Kosongkan jika tidak diubah":"Masukkan PIN 4 digit",maxlength:"4"},null,8,Ae),[[C,l.value.password]])])])]),e("div",De,[e("button",{onClick:U,class:"btn-secondary"},"Batal"),e("button",{onClick:Q,class:"btn-primary",disabled:y.value},i(y.value?"Menyimpan...":"Simpan"),9,Ee)])])])):Y("",!0)],64))}};export{qe as default};
